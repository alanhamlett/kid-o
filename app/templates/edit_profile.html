{% extends 'base.html' %}
{% block content %}

<div>
	<form action="/child/edit{{child.id}}" class="form-signin" method="POST" enctype="multipart/form-data">
	{{ form.csrf_token }}
	<div class="leftbox">
		{% if child.pic_url %}
		<img src="{{child.pic_url}}" id="imgpreview" class="imgpreview" alt="{{child.first_name}}'s photo.">
		{% else %}
		<img src="/static/images/childphotopreview.png" class="images-style">
		{% endif %}
		<input type="file" name="file" id ="imgInput" class="filestyle" data-classButton="btn btn-primary" data-input="true" data-buttonText="Upload" data-classIcon="glyphicon-camera" data-size="sm" value="{{child.pic_url}}">
	</div>
		<div class="info rightbox">
			<label for="doct-field">Child </label><br />
			<input type="text" name="first_name" value="{{child.first_name}}" placeholder="{{child.first_name}}" class="form-control addchildinput"><br />
			<input type="text" name="last_name" value="{{child.last_name}}" placeholder="{{child.last_name}}" class="form-control addchildinput"><br />
			<input type="text" name="birth_date" value="{{child.birth_date.strftime('%Y-%m-%d')}}" placeholder="{{child.birth_date.strftime('%Y-%m-%d')}}" class="form-control addchildinput"><br />
			<label for="doct-field">Guardian </label> <br />
			{% if child.guardian_type %}
			<input type="text" name="guardian_type" value="{{child.guardian_type}}" placeholder="{{child.guardian_type}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="guardian_type" placeholder="Guardian type" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.guardian_fname %}
			<input type="text" name="guardian_fname" value="{{child.guardian_fname}}" placeholder="{{child.guardian_fname}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="guardian_fname" placeholder="Guardian first name" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.guardian_lname %}
			<input type="text" name="guardian_lname" value="{{child.guardian_lname}}" placeholder="{{child.guardian_lname}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="guardian_lname" placeholder="Guardian last name" class="form-control addchildinput"><br />
			{% endif %}
		</div>
		<div class="info rightbox">
			<label for="doct-field">Godparent </label><br />
			{% if child.godparent_prefix %}
			<input type="text" name="godparent_prefix" value="{{child.godparent_prefix}}" placeholder="{{child.godparent_prefix}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="godparent_prefix" placeholder="Godparent prefix" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.godparent_fname %}
			<input type="text" name="godparent_fname" value="{{child.godparent_fname}}" placeholder="{{child.godparent_fname}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="godparent_fname" placeholder="Godparent First Name" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.godparent_lname %}
			<input type="text" name="godparent_lname" value="{{child.godparent_lname}}" placeholder="{{child.godparent_lname}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="godparent_lname" placeholder="Godparent Last Name" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.godparent_email %}
			<input type="text" name="godparent_email" value="{{child.godparent_email}}" placeholder="{{child.godparent_email}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="godparent_email" placeholder="Godparent email" class="form-control addchildinput"><br />
			{% endif %}
		</div>
		<div class="lowerform">
			<label for="med-field"><h3 class="animated2"> Medical Condition</h3></label><br />
			{% if child.medical_condition %}
			<textarea rows="2" cols="20" name="medical_condition" placeholder="{{child.medical_condition}}" class="form-control addchildinput">{{child.medical_condition}}</textarea><br />
			{% else %}
			<textarea rows="2" cols="20" name="medical_condition" placeholder="Currently healthy." class="form-control addchildinput"></textarea><br />
			{% endif %}
			<label for="doct-field">Needs to visit the doctor:</label><br />
			{% if child.doctor_appt %}
			<input type="text" name="doctor_appt" value="{{child.doctor_appt.strftime('%Y-%m-%d')}}" placeholder="{{child.doctor_appt.strftime('%Y-%m-%d')}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="doctor_appt" placeholder="YYYY-M-D" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.situation %}
			<label for="home-field"><h3 class="animated3">Situation:</h3></label><br />
			<textarea rows="3" cols="40" name="situation" placeholder="{{child.situation}}" class="form-control addchildinput">{{child.situation}}</textarea><br />
			{% else %}
			<label for="home-field">Situation:</label><br />
			<textarea rows="3" cols="40" name="situation" placeholder="Please write about {{ child.first_name }}'s situation." class="form-control addchildinput"></textarea><br />
			{% endif %}
			<label for="doct-field">Next home visit:</label><br />
			{% if child.home_visit %}
			<input type="text" name="home_visit" value="{{child.home_visit.strftime('%Y-%m-%d')}}" placeholder="{{child.home_visit.strftime('%Y-%m-%d')}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="home_visit" placeholder="YYYY-M-D" class="form-control addchildinput"><br />
			{% endif %}
			<input type="text" id="lat" name="latitude" class="hidden" value="{{child.latitude}}">
			<input type="text" id="lng" name="longitude" class="hidden" value="{{child.longitude}}">
			<h3> Home Location </h3>
			<div class="mapcontainer">
			<div id="map"></div>
			</div>
			<button class="btn btn-sm btn-primary" type="submit">Save</button> 
			<a href="/child/{{child.id}}"><button type="button" class="btn btn-sm btn-warning" value="cancel">Cancel</button></a>
			<button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#myModal" value="delete">Delete Profile</button>
		</div>
</form>
			<!-- Modal -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			  <div class="modal-dialog modal-sm" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h4 class="modal-title center" id="myModalLabel">WARNING</h4>
			      </div>
			      <div class="modal-body center">
			        Are you sure you want to delete {{ child.first_name }}'s profile?
			      </div>
			      <div class="modal-footer center">
			        <form role="form" method='POST' action='/delete-profile{{child.id}}' enctype="multipart/form-data">
			        <button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>     
				    <button class="btn btn-danger" type="submit">Delete profile</button> 
				     </form>
			      </div>
			    </div>
			  </div>
			</div>
<script>
	$('#myModal').on('shown.bs.modal', function () {
  $('#myInput').focus()
})
</script>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoidmFuZXNhIiwiYSI6ImYxOTAxOGI1NTBlOGJkMTdjZTRmNGVmNTg0NTUxMjFjIn0._G3yYtIvkPX1EC9QEkNB6Q';
var map = L.mapbox.map('map', 'vanesa.e4c935ef')
    .setView([{% if child.latitude and child.longitude %}{{ child.latitude}}, {{child.longitude}}{% else %}18.542769, -69.801216{% endif %}],15);
// Disable the scroll Zoom
    map.scrollWheelZoom.disable();
var marker;
var clicked = false;


marker = L.marker(new L.LatLng({% if child.latitude and child.longitude %}{{ child.latitude}}, {{child.longitude}}{% else %}18.542769, -69.801216{% endif %}));
console.log({% if child.latitude and child.longitude %}{{ child.latitude}}, {{child.longitude}}{% else %}18.542769, -69.801216{% endif %});
marker.addTo(map);

map.on('click', function(e) {
    var child_latitude = e.latlng.lat;
    var child_longitude = e.latlng.lng;
    $("#lat").val(child_latitude)
    $("#lng").val(child_longitude)

   	marker.setLatLng(new L.LatLng(child_latitude, child_longitude)).update();
});
</script>
<script src='../static/js/imgpreview.js'></script>
</div>
{% endblock %}
