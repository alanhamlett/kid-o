{% extends 'base.html' %}
{% block content %}

{% for child in child_info %}
<div>
	<form action="/child/{{child.id}}" class="form-signin" method="POST" enctype="multipart/form-data">
	<div class="leftbox">
		<img src="{{child.pic_url}}" id="imgpreview" class="imgpreview" alt="{{child.first_name}}'s photo.">
		<input type="file" name="file" id ="imgInput" class="filestyle" data-classButton="btn btn-primary" data-input="true" data-buttonText="Upload" data-classIcon="glyphicon-camera" data-size="sm" value="{{child.pic_url}}">
	</div>
		<div class="info rightbox">
			<input type="text" name="first_name" value="{{child.first_name}}" placeholder="{{child.first_name}}" class="form-control addchildinput"><br />
			<input type="text" name="last_name" value="{{child.last_name}}" placeholder="{{child.last_name}}" class="form-control addchildinput"><br />
			<input type="text" name="birth_date" value="{{child.birth_date.strftime('%Y-%m-%d')}}" placeholder="{{child.birth_date.strftime('%Y-%m-%d')}}" class="form-control addchildinput"><br />
			{% if child.guardian_type %}
			<input type="text" name="guardian_type" value="{{child.guardian_type}}" placeholder="{{child.guardian_type}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="guardian_type" placeholder="Guardian type" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.guardian_fname %}
			<input type="text" name="guardian_fname" value="{{child.guardian_fname}}" placeholder="{{child.guardian_fname}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="guardian_fname" placeholder="Guardian first name" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.guardian_lname %}
			<input type="text" name="guardian_lname" value="{{child.guardian_lname}}" placeholder="{{child.guardian_lname}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="guardian_lname" placeholder="Guardian last name" class="form-control addchildinput"><br />
			{% endif %}
		</div>
		<div class="lowerform">
			<label for="med-field"><h3 class="animated2"> Medical Condition</h3></label><br />
			{% if child.medical_condition %}
			<textarea rows="2" cols="20" name="medical_condition" placeholder="{{child.medical_condition}}" class="form-control addchildinput">{{child.medical_condition}}</textarea><br />
			{% else %}
			<textarea rows="2" cols="20" name="medical_condition" placeholder="Currently healthy." class="form-control addchildinput"></textarea><br />
			{% endif %}
			<label for="doct-field">Needs to visit the doctor:</label><br />
			{% if child.doctor_appt %}
			<input type="text" name="doctor_appt" value="{{child.doctor_appt.strftime('%Y-%m-%d')}}" placeholder="{{child.doctor_appt.strftime('%Y-%m-%d')}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="doctor_appt" placeholder="YYYY-M-D" class="form-control addchildinput"><br />
			{% endif %}
			{% if child.situation %}
			<label for="home-field"><h3 class="animated3">Situation:</h3></label><br />
			<textarea rows="3" cols="40" name="situation" placeholder="{{child.situation}}" class="form-control addchildinput">{{child.situation}}</textarea><br />
			{% else %}
			<label for="home-field">Situation:</label><br />
			<textarea rows="3" cols="40" name="situation" placeholder="Please write about {{ child.first_name }}'s situation." class="form-control addchildinput"></textarea><br />
			{% endif %}
			<label for="doct-field">Next home visit:</label><br />
			{% if child.home_visit %}
			<input type="text" name="home_visit" value="{{child.home_visit.strftime('%Y-%m-%d')}}" placeholder="{{child.home_visit.strftime('%Y-%m-%d')}}" class="form-control addchildinput"><br />
			{% else %}
			<input type="text" name="home_visit" placeholder="YYYY-M-D" class="form-control addchildinput"><br />
			{% endif %}
			<input type="text" id="lat" name="latitude" class="hidden" value="{{child.latitude}}">
			<input type="text" id="lng" name="longitude" class="hidden" value="{{child.longitude}}">
			<h3> Home Location </h3>
			<div class="mapcontainer">
			<div id="map"></div>
			</div>
			<button class="btn btn-sm btn-primary" type="submit">Save</button> 
	<a href="/child/{{child.id}}"><button type="button" class="btn btn-sm btn-danger" value="edit">Cancel</button></a>
		</div>
</form>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoidmFuZXNhIiwiYSI6ImYxOTAxOGI1NTBlOGJkMTdjZTRmNGVmNTg0NTUxMjFjIn0._G3yYtIvkPX1EC9QEkNB6Q';
var map = L.mapbox.map('map', 'mapbox.streets')
    .setView([{% if child.latitude and child.longitude %}{{ child.latitude}}, {{child.longitude}}{% else %}18.542769, -69.801216{% endif %}],15);
// Disable the scroll Zoom
    map.scrollWheelZoom.disable();
var marker;
var clicked = false;


marker = L.marker(new L.LatLng({% if child.latitude and child.longitude %}{{ child.latitude}}, {{child.longitude}}{% else %}18.542769, -69.801216{% endif %}));
console.log({% if child.latitude and child.longitude %}{{ child.latitude}}, {{child.longitude}}{% else %}18.542769, -69.801216{% endif %});
marker.addTo(map);

map.on('click', function(e) {
    var child_latitude = e.latlng.lat;
    var child_longitude = e.latlng.lng;
    $("#lat").val(child_latitude)
    $("#lng").val(child_longitude)

   	marker.setLatLng(new L.LatLng(child_latitude, child_longitude)).update();
});
</script>
<script src='../static/js/imgpreview.js'></script>
</div>
	{% endfor %}
{% endblock %}
