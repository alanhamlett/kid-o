{% extends 'base.html' %}
{% block content %}

{% for child in child_info %}
<div class="profile">
  <div class="pull-left photobox"><img src="{{child.pic_url}}" class="imagesedit-style"><a href="uploadlink" class="uploadlink">Upload photo</a></div>
  <form action="/child/{{child.id}}" id="" class="form-signin" method="POST">
    <div class="info pull-right">
      <input type="text" name="first_name" value="{{child.first_name}}" placeholder="{{child.first_name}}"><br />
      <input type="text" name="last_name" value="{{child.last_name}}" placeholder="{{child.last_name}}"><br />
      <input type="text" name="birth_date" value="{{child.birth_date.strftime('%Y-%m-%d')}}" placeholder="{{child.birth_date.strftime('%Y-%m-%d')}}"><br />
      <input type="text" name="guardian_fname" value="{{child.guardian_fname}}" placeholder="{{child.guardian_fname}}"><br />
      <input type="text" name="guardian_lname" value="{{child.guardian_lname}}" placeholder="{{child.guardian_lname}}"><br />
    </div>
    <div class="lowerform">
      <label for="med-field">Medical Condition</label><br />
      <textarea rows="2" cols="20" name="medical_condition" placeholder="{{child.medical_condition}}">{{child.medical_condition}}</textarea><br />
      <label for="doct-field">Needs to visit the doctor:</label><br />
      <input type="text" name="doctor_appt" value="{{child.doctor_appt.strftime('%Y-%m-%d')}}" placeholder="{{child.doctor_appt.strftime('%Y-%m-%d')}}"><br />
      <label for="home-field">Situation:</label><br />
      <textarea rows="3" cols="40" name="situation" placeholder="{{child.situation}}">{{child.situation}}</textarea><br />
      <label for="doct-field">Next home visit:</label><br />
      <input type="text" name="home_visit" value="{{child.home_visit.strftime('%Y-%m-%d')}}" placeholder="{{child.home_visit.strftime('%Y-%m-%d')}}"><br />
      <input type="text" id="lat" name="latitude" class="hidden">
      <input type="text" id="lng" name="longitude" class="hidden">
      <button class="btn btn-sm btn-primary" type="submit">Save</button>
    </div>
</form>

<br style="clear: both" />

  <a href="/child/{{child.id}}"><button type="button" class="btn btn-sm btn-danger" value="edit">Cancel</button></a>
  <br>
  <div class="mapcontainer">
  <div id="map"></div>


<script>
L.mapbox.accessToken = 'pk.eyJ1IjoidmFuZXNhIiwiYSI6ImYxOTAxOGI1NTBlOGJkMTdjZTRmNGVmNTg0NTUxMjFjIn0._G3yYtIvkPX1EC9QEkNB6Q';
var map = L.mapbox.map('map', 'mapbox.streets')
    .setView([18.542769, -69.801216],16);

var marker;
var clicked = false;

map.on('click', function(e) {
    var child_latitude = e.latlng.lat;
    var child_longitude = e.latlng.lng;
    $("#lat").val(child_latitude)
    $("#lng").val(child_longitude)
  
   if (clicked === false) {
           marker = L.marker(new L.LatLng(child_latitude, child_longitude), {
    icon: L.mapbox.marker.icon({
        'marker-color': 'ff8888'
    }),
    draggable: true
});
    marker.bindPopup('This marker is draggable! Move it around.');
       
       marker.addTo(map);
   	   clicked = true;
   }
   else {
   	marker.setLatLng(new L.LatLng(child_latitude, child_longitude)).update();
    }
});
</script>
</div>
</div>
  {% endfor %}
{% endblock %}